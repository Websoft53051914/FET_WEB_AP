@{
    var mapAttr = new
    {
        IdTree = Guid.NewGuid(),
    };

    var storeStyle = new List<string>()
    {
        "CONCEPT STORE", "CONVERGENT CITY", "G5", "REGIONAL CENTER", "RETAIL", "WARRANTY", "G6", "RETAIL", "FRANCHISE"
    };

    var storeType = new List<string>()
    {
        "RETAIL", "FRANCHISE"
    };
}

@section header {
    <style>
        .editTable input[type="text"], textarea {
            width: 100%;
            max-width: 250px;
        }

        .editTable .form-group {
            max-width: 250px;
        }
    </style>
}

<div class="container-fluid">
    <div class="page-header" style="padding-bottom:20px">
        <div class="row">
            <div class="col-sm-6">
                <h3>報修品項維護</h3>
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/Home" data-bs-original-title="" title="">首頁</a></li>
                    <li class="breadcrumb-item">功能</li>
                    <li class="breadcrumb-item active"><a href="" data-bs-original-title="" title="">報修品項維護</a></li>
                </ol>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid">
    <div class="card">
        <div class="card-header">
            <button class="btn btn-info"><i class="fa fa-folder me-2" aria-hidden="true"></i>新增下層</button>
            <button class="btn btn-danger"><i class="fa fa-folder me-2" aria-hidden="true"></i>刪除</button>
            <button class="btn btn-info" style="float:right">儲存</button>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-sm-12 col-md-6 col-lg-3  border shadow-md rounded-3 py-2" style="align-items:stretch;background-color: #fbfbfb;">
                    <div id="@mapAttr.IdTree"></div>
                </div>
                <div class="col-sm-12 col-md-6 col-lg-4 ">
                    <table class="table table-borderless  align-middle editTable">
                        <tbody>
                            <tr>
                                <th class="text-end">CISID：</th>
                                <td><input type="text" class="form-control" value="1303"></td>
                            </tr>
                            <tr>
                                <th class="text-end">名稱類別：</th>
                                <td><input type="text" class="form-control" value="保全卡"></td>
                            </tr>
                            <tr>
                                <th class="text-end">隸屬於：</th>
                                <td>
                                    @await Html.PartialAsync("Form/_ItemsTree", new CommonPartailVM() { ComponentId = Guid.NewGuid().ToString() })
                               </td>
                            </tr>

                            <tr>
                                <th class="text-end">備註：</th>
                                <td><input type="text" class="form-control" value="卡片損壞；卡片遺失"></td>
                            </tr>
                            <tr>
                                <th class="text-end">故障情形描述：</th>
                                <td>
                                    <textarea type="text" class="form-control" value="" rows="2"></textarea>
                                </td>
                            </tr>
                            <tr>
                                <th class="text-end">可報修店格：</th>
                                <td>
                                    <div class="form-group m-checkbox-inline">
                                        @foreach (var item in storeStyle)
                                        {
                                            <div class="form-check checkbox checkbox-primary">
                                                <input class="form-check-input" id="S@(item)" type="checkbox" value="@item" name="123456">
                                                <label class="form-check-label checkbox_short_label" for="S@(item)">@item</label>
                                            </div>
                                        }
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th class="text-end">可報修店家類型：</th>
                                <td>
                                    <div class="form-group m-checkbox-inline">
                                        @foreach (var item in storeType)
                                        {
                                            <div class="form-check checkbox checkbox-primary">
                                                <input class="form-check-input" id="SS@(item)" type="checkbox" value="@item" name="erwre">
                                                <label class="form-check-label checkbox_short_label" for="SS@(item)">@item</label>
                                            </div>
                                        }
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="col-sm-12 col-md-6 col-lg-4 ">
                    <table class="table table-borderless  align-middle editTable">
                        <tbody>
                            <tr>
                                <th class="text-end">圖片路徑：</th>
                                <td><input type="text" class="form-control" value=""></td>
                            </tr>
                            <tr>
                                <th class="text-end">KPI：</th>
                                <td><input type="text" class="form-control" value="3"></td>
                            </tr>
                            <tr>
                                <th class="text-end">門市可自行尋商：</th>
                                <td><input type="text" class="form-control" value="N"></td>
                            </tr>
                            <tr>
                                <th class="text-end">建立時間：</th>
                                <td><input type="text" class="form-control" value="2008/11/9 下午 01:27:13" readonly></td>
                            </tr>
                            <tr>
                                <th class="text-end">異動時間：</th>
                                <td><input type="text" class="form-control" value="2008/11/9 下午 01:27:13" readonly></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

            </div>
        </div>
    </div>
</div>

@section scripts
{
    <script src="~/lib/jsTree/jstree3.3.17.min.js"></script>
    <script>
        const context = {
            $Tree: $("#@mapAttr.IdTree"),
        };
        $(function () {
            context.$Tree.jstree({
                core: {
                    themes: {
                        icons: true,
                    },
                    data: [
                        {
                            "id": "r",
                            "parent": "#",
                            "text": "報修品項",
                            "state": { "opened": true }
                        },
                        {
                            "id": "r1",
                            "parent": "r",
                            "text": "保全"
                        },
                        {
                            "id": "r1-1",
                            "parent": "r1",
                            "text": "保全系統"
                        },
                        { "id": "r1-1-1", "parent": "r1-1", "text": "保全主機" },
                        { "id": "r1-1-2", "parent": "r1-1", "text": "保全卡" },
                        { "id": "r1-1-3", "parent": "r1-1", "text": "玻璃破碎感知器" },
                        { "id": "r1-1-4", "parent": "r1-1", "text": "磁簧感知器" },
                        { "id": "r1-1-5", "parent": "r1-1", "text": "空間感知器" },
                        { "id": "r1-1-6", "parent": "r1-1", "text": "緊急押扣" },
                        { "id": "r1-1-7", "parent": "r1-1", "text": "金庫感知器" },
                        { "id": "r1-1-8", "parent": "r1-1", "text": "護欄周圍感知器" },

                        { "id": "r1-2", "parent": "r1", "text": "商品保全" },
                        { "id": "r1-3", "parent": "r1", "text": "監視系統" },
                        { "id": "r1-4", "parent": "r1", "text": "系統測試" },

                        { "id": "r2", "parent": "r", "text": "停車區域設備" },
                        { "id": "r3", "parent": "r", "text": "傢俱設備" },
                        { "id": "r4", "parent": "r", "text": "小型設備" },
                        { "id": "r5", "parent": "r", "text": "影音設備" },
                        { "id": "r6", "parent": "r", "text": "招牌設備" },
                        { "id": "r7", "parent": "r", "text": "機電設備" },
                        { "id": "r8", "parent": "r", "text": "直營取叫號機" },
                        { "id": "r9", "parent": "r", "text": "空調設備" },
                        { "id": "r10", "parent": "r", "text": "裝潢設備" },
                        { "id": "r11", "parent": "r", "text": "門市多媒體設備" },
                        { "id": "r11-1", "parent": "r11", "text": "測試" }
                    ],
                    multiple: false
                },
                plugins: ["themes", 'search'],
                checkbox: {
                    keep_selected_style: true,
                    three_state: false,
                },
                search: {
                    case_sensitive: false,
                    show_only_matches: true
                }
            }).on('loaded.jstree', function (e, data) {

                let jsonArr = context.$Tree.jstree(true).get_json("#", { flat: true });
                let nodeIds = [];
                let domParser = new DOMParser();
                for (let i = 0; i < jsonArr.length; i++) {
                    let node = data.instance.get_node(jsonArr[i].id);
                    if (node.original.value) {
                        const value = node.original.value;
                        if (selectedItemVal == value) {
                            nodeIds.push(node.id);
                            let htm = `<span class="partialDisplayTag" data-id = '${value}' > ${node.text}</span>`;
                            let cntNode = domParser.parseFromString(htm, "text/html").body.childNodes;
                            $ProjDisplayPool[0].appendChild(cntNode[0]);
                            selectedItem.push({ text: node.text, value: node.original.value, id: node.id })
                        }
                    }
                    else {
                        node.a_attr['class'] = "no_checkbox";
                    }
                }
                context.$Tree.jstree(true).settings.core.data = data;
                context.$Tree.jstree(true).redraw(true);
                context.$Tree.jstree('select_node', nodeIds);
            });

        });

    </script>
}
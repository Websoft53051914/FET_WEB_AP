@{
    var EventName = ViewData["EventName"];
}
    <style>
        .even .jsgrid-cell {
            background-color: white; 
        }
    </style>

<div class="modal fade max100vh" id="RMItemListSelfVendorModal" tabindex="-1" role="dialog" aria-labelledby="RMItemListSelfVendorModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered " role="document" style="min-width:60%">
        <div class="modal-content">
            <div class="modal-header text-center">
                <h5>報修品項</h5>
                <button class="btn-close" type="button" aria-label="Close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="RMItemListSelfVendorGrid"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" type="button" id="RMItemListSelfVendorModalConfirm">確認</button>
            </div>
        </div>
    </div>
</div>

<script>
    //RMItemListSelfVendorGrid jsGrid init
    $(function () {
        $("#RMItemListSelfVendorGrid").jsGrid({
            width: "100%",
            height: "auto",
            autoload: false,
            paging: true,
            pageSize: pageDataSource[0].id,
            pageButtonCount: 5,
            pagerFormat: "{first} {prev} {pages} {next} {last}    第 {pageIndex} 頁 共 {pageCount} 頁",
            pagePrevText: "上一頁",
            pageNextText: "下一頁",
            pageFirstText: "第一頁",
            pageLastText: "最後一頁",
            pageLoading: true,
            onDataLoaded: function () {
                feather.replace();
            },
            rowClass: function (item, itemIndex) {
               //設定行class
                return itemIndex % 2 === 0 ? "even" : "odd";
            },
            rowClick: function (args) {
                //點擊行時，選中checkbox 單選
                $("input[name='RMItemListSelfVendorCheckbox']").prop("checked", false);
                $(args.event.target).closest("tr").find("input[name='RMItemListSelfVendorCheckbox']").prop("checked", true);
            },
            controller: {
                loadData: function (filter) {
                    var d = $.Deferred();
                    $.ajax({
                        type: "POST",
                        url: "@Url.Action("GetCiDataSelfVendorPageList", "Api")",
                        data: filter,
                        dataType: "json",
                        success: function (res) {
                            if (res.Success === false) {
                                swal({
                                    text: res.Message,
                                    icon: "error",
                                    button: "確認"
                                });
                                d.reject();
                                return;
                            }
                            var da = {
                                data: res.Data,
                                itemsCount: res.Total
                            }
                            d.resolve(da);
                        }
                    })

                    return d.promise();
                }
            },
            fields: [
                {
                    type: 'control', align: "center",
                    width: 80,
                    editButton: false,
                    deleteButton: false,
                    headerTemplate: (value, item) => {
                        return "";
                    },
                    itemTemplate: (value, item) => {
                        //checkbox
                        return $("<input>")
                            .attr("type", "checkbox")
                            .attr("name", "RMItemListSelfVendorCheckbox")
                            .attr("value", item.CISID);
                    }
                },
                { name: "CISID", type: "number",width:120},
                { name: "CINAME", type: "text", title: "品項名稱" ,width:250},
                { name: "ACINAME", type: "text", title: "品項描述" ,width:300},
                {width:'auto'}
            ]
        });

        //RMItemListSelfVendorModal on show
        $('#RMItemListSelfVendorModal').on('show.bs.modal', function (e) {
            //清空checkbox
            $("input[name='RMItemListSelfVendorCheckbox']").prop("checked", false);
            //重新載入資料
            $("#RMItemListSelfVendorGrid").jsGrid("loadData");
        });
        //RMItemListSelfVendorModal confirm button click
        $('#RMItemListSelfVendorModalConfirm').on('click', function (e) {
            //取得選中的checkbox
            let selectedItem = $("input[name='RMItemListSelfVendorCheckbox']:checked").val();
            let selectedItemText = $("input[name='RMItemListSelfVendorCheckbox']:checked").closest("tr").find("td:nth-child(3)").text();
            if (!selectedItem) {
                swal({
                    text: "請選擇一個品項",
                    icon: "warning",
                    button: "確認"
                });
                return;
            }
            //觸發自定義事件，傳遞選中的品項
            $(document).trigger("@Html.Raw(EventName)", {
                selectedItem: selectedItem,
                selectedItemText: selectedItemText
            });
            //關閉modal
            $('#RMItemListSelfVendorModal').modal('hide');
        });
    });

</script>